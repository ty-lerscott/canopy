{"version":3,"sources":["api/image/utils/og.ts"],"sourcesContent":["import ogImageTemplate from \"@/api/html/templates/og-image\";\nimport getImage from \"@/api/image/utils/get-image\";\nimport puppeteer from \"@/api/utils/puppeteer\";\nimport codes from \"@/api/utils/status-codes\";\nimport type { GetResponse } from \"@/types\";\n\nconst og = async ({\n\turl,\n\ttitle,\n\tsubtitle,\n}: {\n\turl: string;\n\ttitle?: string;\n\tsubtitle?: string;\n}): Promise<GetResponse> => {\n\tconst responseBody: GetResponse<Buffer> = {\n\t\tstatus: codes.BAD_REQUEST,\n\t};\n\ttry {\n\t\tconst { data, width, height } = await getImage(url);\n\n\t\tconst { page, browser } = await puppeteer();\n\t\tawait page.setViewport({ height, width });\n\t\tawait page.setContent(\n\t\t\togImageTemplate({\n\t\t\t\timage: data?.toString(\"base64\"),\n\t\t\t\ttitle,\n\t\t\t\tsubtitle,\n\t\t\t}),\n\t\t);\n\n\t\tconst imageBuffer = await page.screenshot({ type: \"png\" });\n\t\tawait browser.close();\n\n\t\tresponseBody.data = imageBuffer;\n\t\tresponseBody.headers = {\n\t\t\t\"Content-Type\": \"image/png\",\n\t\t\t\"Content-Length\": imageBuffer?.length.toString() || \"0\",\n\t\t};\n\t\tresponseBody.status = codes.OK;\n\t} catch (err) {\n\t\tresponseBody.status = codes.SERVER_ERROR;\n\t\tresponseBody.error = (err as Error).message;\n\t}\n\n\treturn responseBody;\n};\n\nexport default og;\n"],"mappings":"2JAMA,IAAMA,EAAK,MAAO,CACjB,IAAAC,EACA,MAAAC,EACA,SAAAC,CACD,IAI4B,CAC3B,IAAMC,EAAoC,CACzC,OAAQC,EAAM,WACf,EACA,GAAI,CACH,GAAM,CAAE,KAAAC,EAAM,MAAAC,EAAO,OAAAC,CAAO,EAAI,MAAMC,EAASR,CAAG,EAE5C,CAAE,KAAAS,EAAM,QAAAC,CAAQ,EAAI,MAAMC,EAAU,EAC1C,MAAMF,EAAK,YAAY,CAAE,OAAAF,EAAQ,MAAAD,CAAM,CAAC,EACxC,MAAMG,EAAK,WACVG,EAAgB,CACf,MAAOP,GAAM,SAAS,QAAQ,EAC9B,MAAAJ,EACA,SAAAC,CACD,CAAC,CACF,EAEA,IAAMW,EAAc,MAAMJ,EAAK,WAAW,CAAE,KAAM,KAAM,CAAC,EACzD,MAAMC,EAAQ,MAAM,EAEpBP,EAAa,KAAOU,EACpBV,EAAa,QAAU,CACtB,eAAgB,YAChB,iBAAkBU,GAAa,OAAO,SAAS,GAAK,GACrD,EACAV,EAAa,OAASC,EAAM,EAC7B,OAASU,EAAK,CACbX,EAAa,OAASC,EAAM,aAC5BD,EAAa,MAASW,EAAc,OACrC,CAEA,OAAOX,CACR,EAEOY,EAAQhB","names":["og","url","title","subtitle","responseBody","status_codes_default","data","width","height","get_image_default","page","browser","puppeteer_default","og_image_default","imageBuffer","err","og_default"]}